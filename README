backup-test
===========

A unit-testing framework for OS X backup tools.
Written by Nathaniel Gray.
n8gray /at/ n8gray \dot\ org

About
=====

This is a framework for systematically testing backup tools in OS X.  It
contains a suite of tests to verify that metadata has survived a copy operation,
along with a suite of copiers.  It will even automatically prepare disk images
as source/destination targets for you.

Be aware that this program is a great big hack that doesn't do a lot of error
checking.  You're encouraged to use the autopilot script to make sure you don't
stray too far from what the program expects.

Prerequisites
=============

In order to examine/set Finder metadata attributes, the following utilities are
required:

* SetFile
* GetFileInfo

These are included with the XCode developer tools, and backup-test expects them
to be in /Developer/Tools.  If they're not there for some reason, add their
location to your PATH and all will be well.

Installation & Usage
====================

"Installation" is simple
1. run "make"
2. there's no step 2.

You can now run "backup-test" with no arguments for usage info.  Or, you can run
"./autopilot" to automatically generate some disk images, run all tests, and see
the results.

Note that many of the tests and all of the copiers require root priveleges.  
They run using sudo, so you'll be prompted for your password.  This also means
you need to run the suite as a member of the admin group.

One more thing.  As with most Bash scripts, this isn't guaranteed to handle
pathnames with spaces well.  So please, don't put spaces in your test volume
names!

Adding Tests
============

Adding tests is easy!  Just copy an existing test and fill in the functions.
Take a look at tests.d/00-basic-permissions.test for comments on the arguments
and expected behavior of each function.

After you add a test you need to re-run 'backup-test create' on your source
volume.

Adding Copiers
==============

Adding copiers is easy too!  Again, just copy an existing .cp file and fill
in the functions.  See copiers.d/10-rsync-apple.cp for comments on the arguments
and expected behavior of each function.

You should understand that you don't have to add a copier to test your favorite
copy mechanism.  You can do the copy by hand and then use 'backup-test verify'
to do the verification.  Copiers are just there to ease automated testing.

History
=======

This work was inspired by the plasticsfuture blog post[1] on the (rather sad)
state of OS X backup tools.  The post was an extremely valuable contribution in
many ways, but it was particularly helpful for simply enumerating all (?) of the
many and varied metadata attributes of a modern Mac HFS+ volume.  However,
despite requests from myself and others, maurits neglected to release his test
suite to the public.

The topic of backup fidelity became important to me personally as the hard drive
in my powerbook started dying the death of a thousand bad blocks.  So I set out
to reproduce maurits' results and run some extra tests of my own.

References
==========
[1] The post that started it all: 
    <http://blog.plasticsfuture.org/2006/03/05/the-state-of-backup-and-cloning-tools-under-mac-os-x/>

[2] A nice, though not 100% accurate site on OS X filesystem metadata.  Includes references!
    <http://www.macos-x-server.com/wiki/index.php?title=Filesystem_metadata_support>

